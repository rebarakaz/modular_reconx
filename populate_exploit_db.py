#!/usr/bin/env python3
"""
Script to populate the local exploit database with sample data
"""

import sys
import os

# Add the parent directory to the path
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

from app.modules.exploit_db import initialize_exploit_database, update_exploit_database

def populate_sample_exploits():
    """Populate the exploit database with sample data"""
    print("Populating exploit database with sample data...")
    
    # Initialize the database
    if not initialize_exploit_database():
        print("Failed to initialize exploit database")
        return False
    
    # Sample exploit data
    sample_exploits = [
        {
            "id": "EXP-001",
            "title": "Apache HTTP Server 2.4.49 - Path Traversal",
            "description": "A flaw was found in Apache HTTP Server 2.4.49. An attacker could bypass access control to files and directories protected by mod_alias, mod_userdir, or mod_lua directives.",
            "platform": "linux",
            "type": "remote",
            "author": "Anonymous",
            "date_published": "2021-10-04",
            "verified": True,
            "codes": "CVE-2021-41773",
            "tags": "apache,httpd,CVE-2021-41773,path,traversal",
            "href": "https://www.exploit-db.com/exploits/50406"
        },
        {
            "id": "EXP-002",
            "title": "WordPress Plugin WP Statistics 13.0.8 - Remote Code Execution",
            "description": "The WP Statistics WordPress plugin is vulnerable to Remote Code Execution in versions up to, and including, 13.0.8.",
            "platform": "php",
            "type": "webapps",
            "author": "Security Researcher",
            "date_published": "2021-11-15",
            "verified": True,
            "codes": "CVE-2021-25077",
            "tags": "wordpress,plugin,wp-statistics,CVE-2021-25077,rce",
            "href": "https://www.exploit-db.com/exploits/50554"
        },
        {
            "id": "EXP-003",
            "title": "Microsoft Windows SMBv3 - Remote Code Execution",
            "description": "A remote code execution vulnerability exists in the way that the Microsoft Server Message Block 3.1.1 (SMBv3) protocol handles certain requests.",
            "platform": "windows",
            "type": "remote",
            "author": "Microsoft Security Response Center",
            "date_published": "2020-03-11",
            "verified": True,
            "codes": "CVE-2020-0796",
            "tags": "windows,smb,smbv3,CVE-2020-0796,rce",
            "href": "https://www.exploit-db.com/exploits/48223"
        },
        {
            "id": "EXP-004",
            "title": "Log4j 2.14.1 - Remote Code Execution",
            "description": "Apache Log4j2 <=2.14.1 JNDI features used in configuration, log messages, and parameters do not protect against attacker controlled LDAP and other JNDI related endpoints.",
            "platform": "java",
            "type": "remote",
            "author": "Apache Software Foundation",
            "date_published": "2021-12-10",
            "verified": True,
            "codes": "CVE-2021-44228",
            "tags": "log4j,apache,CVE-2021-44228,rce,log4shell",
            "href": "https://www.exploit-db.com/exploits/50540"
        },
        {
            "id": "EXP-005",
            "title": "vsftpd 2.3.4 - Backdoor Command Execution",
            "description": "vsftpd version 2.3.4 contains a backdoor which opens a shell on port 6200/tcp.",
            "platform": "linux",
            "type": "remote",
            "author": "Anonymous",
            "date_published": "2011-07-04",
            "verified": True,
            "codes": "",
            "tags": "vsftpd,ftp,backdoor,rce",
            "href": "https://www.exploit-db.com/exploits/17491"
        }
    ]
    
    # Update the database with sample exploits
    if update_exploit_database(sample_exploits):
        print(f"Successfully populated database with {len(sample_exploits)} sample exploits")
        return True
    else:
        print("Failed to populate exploit database")
        return False

if __name__ == "__main__":
    populate_sample_exploits()